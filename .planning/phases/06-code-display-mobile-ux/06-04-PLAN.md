---
phase: 06-code-display-mobile-ux
plan: 04
type: execute
wave: 2
depends_on: ["06-03"]
files_modified:
  - src/claude/summary_generator.py
  - tests/test_summary_generator.py
autonomous: true

must_haves:
  truths:
    - "Code changes have plain-English summaries"
    - "Summaries concise and informative"
    - "User can understand change without reading full diff"
  artifacts:
    - path: "src/claude/summary_generator.py"
      provides: "Plain-English change summarization"
      min_lines: 80
      exports: ["SummaryGenerator"]
    - path: "tests/test_summary_generator.py"
      provides: "Test coverage for summary generation"
      min_lines: 100
  key_links:
    - from: "SummaryGenerator"
      to: "DiffRenderer"
      via: "Uses parsed diff data"
      pattern: "DiffObject.*generate"
---

<objective>
Create plain-English summary generator for code changes.

Purpose: Enable quick understanding of changes without reading full diffs.
Output: SummaryGenerator class that converts diffs to readable descriptions.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Phase 6 dependencies
@.planning/phases/06-code-display-mobile-ux/06-03-SUMMARY.md

# Diff structures to summarize
@src/claude/diff_renderer.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SummaryGenerator (TDD)</name>
  <files>src/claude/summary_generator.py, tests/test_summary_generator.py</files>
  <action>
    **RED Phase:**
    Write failing tests in tests/test_summary_generator.py:
    - test_generate_single_file_summary() - "Modified file.py: added function foo()"
    - test_generate_multi_file_summary() - "3 files changed: file1.py, file2.js, file3.ts"
    - test_summarize_additions() - "Added 15 lines in function bar()"
    - test_summarize_deletions() - "Removed 8 lines from class Foo"
    - test_summarize_modifications() - "Updated error handling in validate()"
    - test_detect_refactoring() - "Refactored: renamed variable x to user_id"
    - test_detect_import_changes() - "Added imports: asyncio, typing"
    - test_concise_summary() - Summary < 200 chars for mobile display

    Run pytest - tests must fail.

    Commit: `test(06-04): add failing tests for summary generator`

    **GREEN Phase:**
    Implement src/claude/summary_generator.py:
    - SummaryGenerator class with generate(diff_obj: DiffObject) -> str
    - Pattern detection:
      - Function/class additions: "Added function/class X"
      - Import changes: "Added imports: ..."
      - Refactoring: Look for renamed variables, moved code
      - Error handling: try/except blocks
    - Summarization rules:
      - Single file: "Modified {file}: {action}"
      - Multi-file: "{N} files changed: {file1}, {file2}, ..."
      - Keep summary < 200 chars

    Run pytest - all tests pass.

    Commit: `feat(06-04): implement SummaryGenerator with pattern detection`

    **REFACTOR Phase:**
    - Extract pattern matching rules
    - Simplify summary construction

    Only commit if changes made: `refactor(06-04): extract summary patterns`
  </action>
  <verify>pytest tests/test_summary_generator.py -v shows all tests passing</verify>
  <done>SummaryGenerator produces concise plain-English summaries from diff objects</done>
</task>

<task type="auto">
  <name>Task 2: Integrate SummaryGenerator into SignalResponder</name>
  <files>src/claude/responder.py, tests/test_claude_responder.py</files>
  <action>
    Extend SignalResponder to include summaries with code changes:
    - Import SummaryGenerator, DiffRenderer
    - Add _summary_generator = SummaryGenerator() instance
    - Add _diff_renderer = DiffRenderer() instance
    - When Response contains diff output:
      - Parse diff with diff_renderer.parse()
      - Generate summary with summary_generator.generate()
      - Format as: "Summary: {summary}\n\nFull diff: {overlay_mode_diff}"

    Add tests in tests/test_claude_responder.py:
    - test_format_response_with_diff_includes_summary() - Summary appears before diff
    - test_format_response_large_diff_summary_only() - Large diff shows summary only
    - test_format_response_small_diff_both() - Small diff shows summary + full diff

    Run full test suite: pytest tests/test_claude_responder.py -v

    Commit: `feat(06-04): integrate summaries into SignalResponder for diffs`
  </action>
  <verify>pytest shows all responder tests passing with summary integration</verify>
  <done>SignalResponder includes plain-English summaries before showing diffs</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] pytest tests/test_summary_generator.py -v passes
- [ ] pytest tests/test_claude_responder.py -v passes
- [ ] Summaries concise (< 200 chars)
- [ ] Pattern detection works (functions, imports, refactoring)
- [ ] Summary appears before full diff in responses
</verification>

<success_criteria>
- All tasks completed
- All tests passing
- TDD cycle followed
- CODE-05 requirement satisfied (plain-English summaries)
- Summaries intelligible without reading code
</success_criteria>

<output>
After completion, create `.planning/phases/06-code-display-mobile-ux/06-04-SUMMARY.md`
</output>
