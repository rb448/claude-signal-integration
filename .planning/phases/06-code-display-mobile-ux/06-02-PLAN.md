---
phase: 06-code-display-mobile-ux
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/claude/syntax_highlighter.py
  - tests/test_syntax_highlighter.py
autonomous: true

must_haves:
  truths:
    - "Syntax highlighting applies to code displayed on mobile"
    - "Highlighting readable on 320px screens"
    - "Multiple languages supported (Python, JS, TS, etc.)"
  artifacts:
    - path: "src/claude/syntax_highlighter.py"
      provides: "ANSI-based syntax highlighting for mobile terminals"
      min_lines: 60
      exports: ["SyntaxHighlighter"]
    - path: "tests/test_syntax_highlighter.py"
      provides: "Test coverage for highlighter"
      min_lines: 80
  key_links:
    - from: "SyntaxHighlighter"
      to: "CodeFormatter"
      via: "highlight() method called before format()"
      pattern: "highlight.*language"
---

<objective>
Implement mobile-friendly syntax highlighting using ANSI color codes.

Purpose: Make code more readable on mobile with color-coded syntax elements.
Output: SyntaxHighlighter class using Pygments library for ANSI terminal output.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Phase 6 context
@.planning/phases/06-code-display-mobile-ux/06-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SyntaxHighlighter with Pygments (TDD)</name>
  <files>src/claude/syntax_highlighter.py, tests/test_syntax_highlighter.py</files>
  <action>
    **RED Phase:**
    Write failing tests in tests/test_syntax_highlighter.py:
    - test_highlight_python_code() - Python keywords colored
    - test_highlight_javascript_code() - JS syntax colored
    - test_highlight_typescript_code() - TS syntax colored
    - test_highlight_unknown_language_fallback() - Unknown lang returns plain text
    - test_ansi_codes_present() - Output contains ANSI escape sequences
    - test_mobile_friendly_colors() - Uses high-contrast colors (no dark gray on black)

    Run pytest - tests must fail (no implementation).

    Commit: `test(06-02): add failing tests for syntax highlighter`

    **GREEN Phase:**
    Install Pygments if not present: pip install pygments

    Implement src/claude/syntax_highlighter.py:
    - SyntaxHighlighter class with highlight(code: str, language: str) -> str
    - Use pygments.highlight() with TerminalFormatter (ANSI output)
    - Language detection via get_lexer_by_name()
    - Fallback to TextLexer for unknown languages
    - Use high-contrast terminal256 style (good for mobile)

    Run pytest - all tests must pass.

    Commit: `feat(06-02): implement SyntaxHighlighter with Pygments`

    **REFACTOR Phase (if needed):**
    - Cache lexers to avoid repeated lookups
    - Extract color scheme configuration

    Only commit if changes made: `refactor(06-02): optimize lexer caching`
  </action>
  <verify>pytest tests/test_syntax_highlighter.py -v shows all tests passing</verify>
  <done>SyntaxHighlighter produces ANSI-colored code for common languages, falls back gracefully</done>
</task>

<task type="auto">
  <name>Task 2: Integrate SyntaxHighlighter into CodeFormatter</name>
  <files>src/claude/code_formatter.py, tests/test_code_formatter.py</files>
  <action>
    Extend CodeFormatter in src/claude/code_formatter.py:
    - Import SyntaxHighlighter
    - Add _highlighter = SyntaxHighlighter() instance variable
    - Modify format() to call highlighter.highlight(code, language) before wrapping
    - Highlighted code still wrapped at 80 chars (preserve ANSI sequences during wrap)

    Add tests in tests/test_code_formatter.py:
    - test_format_with_syntax_highlighting() - Python code has ANSI colors
    - test_highlighting_preserved_after_wrap() - Colors work with line wrapping
    - test_unknown_language_still_formats() - Unknown lang formatted but not colored

    Run full test suite: pytest tests/test_syntax_highlighter.py tests/test_code_formatter.py -v

    Commit: `feat(06-02): integrate syntax highlighting into CodeFormatter`
  </action>
  <verify>pytest shows all highlighter and formatter tests passing</verify>
  <done>CodeFormatter applies syntax highlighting before formatting, preserves colors during wrapping</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] pytest tests/test_syntax_highlighter.py -v passes
- [ ] pytest tests/test_code_formatter.py -v passes
- [ ] Python code displays with colored syntax
- [ ] Unknown languages fall back to plain text
- [ ] ANSI codes preserved during line wrapping
</verification>

<success_criteria>
- All tasks completed
- All tests passing (highlighter + formatter)
- TDD cycle followed (test commits before feat commits)
- Pygments dependency added to requirements
- CODE-03 requirement satisfied (syntax highlighting on mobile)
</success_criteria>

<output>
After completion, create `.planning/phases/06-code-display-mobile-ux/06-02-SUMMARY.md`
</output>
