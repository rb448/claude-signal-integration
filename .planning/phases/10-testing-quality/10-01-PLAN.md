---
phase: 10-testing-quality
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/TEST-AUDIT.md
  - tests/coverage_report.txt
autonomous: true

must_haves:
  truths:
    - "All core components have test files with meaningful test coverage"
    - "Test coverage report shows >80% line coverage for core modules"
    - "Git history shows test-first commits for business logic components from Phases 1-9"
    - "Missing test coverage identified and documented with remediation plan"
  artifacts:
    - path: ".planning/TEST-AUDIT.md"
      provides: "TDD compliance report for Phases 1-9"
      min_lines: 50
      contains: "## TDD Compliance"
    - path: "tests/coverage_report.txt"
      provides: "Coverage metrics by module"
      min_lines: 20
  key_links:
    - from: ".planning/TEST-AUDIT.md"
      to: "git history"
      via: "commit pattern analysis (test → feat → refactor)"
      pattern: "git log.*test.*feat"
    - from: "tests/coverage_report.txt"
      to: "pytest-cov"
      via: "pytest --cov execution"
      pattern: "pytest --cov"
---

<objective>
Audit TDD compliance across Phases 1-9 and generate comprehensive test coverage report.

Purpose: Validate that prior phases followed TDD discipline and identify coverage gaps requiring remediation. This establishes the baseline for Phase 10's testing improvements.

Output: TEST-AUDIT.md documenting TDD compliance by phase, and coverage_report.txt showing current test coverage metrics.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Phase 10 requirements this plan addresses:
# - TEST-01: All core components have unit tests with >80% coverage
# - TEST-02: Integration tests verify Signal ↔ Claude Code communication flows (baseline check)

# Prior phase summaries for TDD audit:
@.planning/phases/01-signal-core-infrastructure/01-01-SUMMARY.md
@.planning/phases/02-session-management-durable-execution/02-01-SUMMARY.md
@.planning/phases/03-claude-integration/03-01-SUMMARY.md
@.planning/phases/04-multi-project-support/04-01-SUMMARY.md
@.planning/phases/05-permission-approval-workflows/05-01-SUMMARY.md
@.planning/phases/06-code-display-mobile-ux/06-01-SUMMARY.md
@.planning/phases/07-connection-resilience/07-01-SUMMARY.md
@.planning/phases/08-notification-system/08-01-SUMMARY.md
@.planning/phases/09-advanced-features/09-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit git history for TDD commit patterns</name>
  <files>.planning/TEST-AUDIT.md</files>
  <action>
    For each phase (1-9), analyze git log to verify TDD discipline:
    1. Run `git log --oneline --all | grep -E "(test|feat|refactor)\(0[1-9]-"` to find phase commits
    2. For each phase, check if test commits preceded feature commits
    3. Identify business logic components (not infra/config) and verify test-first pattern
    4. Document findings in TEST-AUDIT.md with structure:
       - Phase number and name
       - TDD compliance status (compliant/partial/non-compliant)
       - Commit pattern analysis (test → feat → refactor observed?)
       - Components that followed TDD vs components that didn't
       - Recommendations for retroactive testing if gaps exist

    Focus on business logic modules per roadmap TDD strategy:
    - Session lifecycle state machine (Phase 2)
    - Claude command parser (Phase 3)
    - Approval state machine (Phase 5)
    - Code formatter/diff renderer (Phase 6)
    - Reconnection manager (Phase 7)
    - Notification categorizer (Phase 8)
    - Emergency mode state machine (Phase 9)
  </action>
  <verify>
    - `cat .planning/TEST-AUDIT.md | grep "Phase [1-9]"` shows 9 phase sections
    - Report includes commit hash examples for test-first vs build-then-test patterns
    - Recommendations section lists specific modules needing retroactive tests
  </verify>
  <done>TEST-AUDIT.md exists with complete TDD compliance analysis for all 9 prior phases</done>
</task>

<task type="auto">
  <name>Task 2: Generate comprehensive test coverage report</name>
  <files>tests/coverage_report.txt</files>
  <action>
    Run pytest with coverage to establish baseline metrics:
    1. Install coverage tool if needed: `pip install pytest-cov`
    2. Run full test suite with coverage: `pytest --cov=src --cov-report=term-missing > tests/coverage_report.txt`
    3. Parse report to extract:
       - Overall coverage percentage
       - Per-module coverage (src/daemon, src/session, src/claude, etc.)
       - Uncovered lines by file
    4. Identify modules below 80% threshold
    5. Cross-reference with TEST-AUDIT.md to correlate low coverage with TDD compliance gaps

    Save both the full pytest-cov output and a summary showing:
    - Modules meeting >80% threshold (green)
    - Modules below 80% needing improvement (yellow)
    - Modules with <50% requiring immediate attention (red)
  </action>
  <verify>
    - `pytest --cov=src --cov-report=term` runs successfully
    - coverage_report.txt contains coverage percentages for all src modules
    - Report identifies specific uncovered line ranges
  </verify>
  <done>Coverage report generated showing baseline metrics for all source modules</done>
</task>

<task type="auto">
  <name>Task 3: Document coverage gaps and remediation plan</name>
  <files>.planning/TEST-AUDIT.md</files>
  <action>
    Append coverage gap analysis to TEST-AUDIT.md:
    1. Create "## Coverage Gaps" section
    2. List modules below 80% coverage with:
       - Current coverage percentage
       - Missing test scenarios (based on uncovered lines)
       - Priority (critical if <50%, medium if 50-80%)
    3. Create "## Remediation Plan" section with:
       - Specific test files to create or enhance
       - Test scenarios to add (unit, integration, edge cases)
       - Estimated effort (plan count) to reach >80% for all modules
    4. Cross-reference with Phase 10 requirements (TEST-01 through TEST-08)
    5. Recommend which gaps should be addressed in Phase 10 vs deferred

    Prioritize gaps that block Phase 10 success criteria:
    - Integration test coverage (TEST-02)
    - Load testing infrastructure (TEST-03)
    - Chaos testing for reconnection (TEST-05)
  </action>
  <verify>
    - TEST-AUDIT.md contains "## Coverage Gaps" with module-by-module analysis
    - Remediation plan maps to specific Phase 10 requirements
    - Priority levels assigned to each gap
  </verify>
  <done>Complete remediation plan documented with clear priorities and effort estimates</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pytest --cov=src --cov-report=term` runs without errors
- [ ] TEST-AUDIT.md exists and contains TDD compliance analysis for Phases 1-9
- [ ] coverage_report.txt exists with baseline metrics
- [ ] Remediation plan documents specific gaps and priorities
</verification>

<success_criteria>
- All tasks completed
- TDD audit complete for all 9 prior phases
- Coverage baseline established with >80% target identified
- Gaps documented with clear remediation priorities
- Foundation ready for subsequent Phase 10 testing improvements
</success_criteria>

<output>
After completion, create `.planning/phases/10-testing-quality/10-01-SUMMARY.md`
</output>
